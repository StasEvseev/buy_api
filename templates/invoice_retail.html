{% extends 'admin/master.html' %}

{% block body %}

    <ul class="nav nav-pills">
        <a class="btn btn-primary" href="{{ url_prices }}">Назад</a>
        <div class="pull-right">
            <button class="btn btn-primary">Click</button>
        </div>
    </ul>
    <br/>

    <div class="alert alert-warning" role="alert">
      <strong>Внимание!</strong><br/>
      Позиции обозначенные красным цветом не попадут в накладную.
    </div>

    <div ng-app="myApp" ng-controller="MainCtrl">
        <h3>Товары:</h3>
        <button class="btn btn-primary" ng-click="openToAdd()">Добавить</button>
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>№</th>
                    <th>Наименование</th>
                    <th>Количество</th>
                    <th>Цена розницы (руб.)</th>
                    <th>Действия</th>
                </tr>
            </thead>

            <tbody>
                <tr ng-repeat="item in model.items">

                    <td ng-class="{danger: !item.is_approve}">
                        {{ '$index + 1'|angular }}
                    </td>

                    <td ng-class="{danger: !item.is_approve}">
                        <del ng-if="!item.is_approve">
                            {{ item.full_name|angular }}
                        </del>
                        <span ng-if="item.is_approve">
                            {{ item.full_name|angular }}
                        </span>

                    </td>
                    <td ng-class="{danger: !item.is_approve}">
                        {{ item.count|angular }}
                    </td>
                    <td ng-class="{danger: !item.is_approve}">
                        {{ item.price_retail|angular}}
                    </td>

                    <td>
                        <span ng-hide="item.is_approve"><button ng-disabled="!item.price_retail" class="btn btn-success btn-block btn-sm" ng-click="addToInvoice(item)">Добавить</button></span>

                        <span ng-hide="!item.is_approve"><button class="btn btn-danger btn-block btn-sm" ng-click="removeFromInvoice(item)">Убрать</button></span>
                    </td>

                </tr>

            </tbody>
        </table>

        <script type="text/ng-template" id="myModalContent.html">
            <div class="modal-header">
                <h3 class="modal-title">Добавление товара в розничную накладную</h3>
            </div>
            <div class="modal-body">
                <p>Выбран: {{person.selected|angular}}</p>
                <ui-select ng-model="model.selected" theme="select2" ng-disabled="disabled" style="min-width: 300px;">
                    <ui-select-match placeholder="Выберите товар или поищите его...">
                        {{'$select.selected.name'|angular}}
                    </ui-select-match>
                    <ui-select-choices repeat="commodity in model.commodity_items | propsFilter: {name: $select.search, price_retail: $select.search}">
                        <div ng-bind-html="commodity.name | highlight: $select.search"></div>
                        <small>
                            Цена розницы: <span ng-bind-html="''+commodity.price_retail | highlight: $select.search"></span>
                        </small>
                    </ui-select-choices>
                </ui-select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" ng-click="ok()">OK</button>
                <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
            </div>
        </script>

    </div>



{% endblock %}

{% block tail %}

    <script type="text/javascript">
        var INVOICE_ID = {{ invoice_id }};
    </script>

    {% assets "css_all" %}
        <link rel="stylesheet" href="{{ ASSET_URL }}" />
    {% endassets %}
    {% assets "select-css" %}
        <link rel="stylesheet" href="{{ ASSET_URL }}" />
    {% endassets %}

    {% assets "angularjs" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}

    {% assets "angularjs-ui-bootstrap" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}

    {% assets "bootbox" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}

    {% assets "select-js" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}

    {% assets "invoice_retail" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}

{% endblock %}